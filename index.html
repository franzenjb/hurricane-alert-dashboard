<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florida Hurricane Alert Dashboard - Official Emergency Management System</title>
    <meta name="description" content="Official hurricane tracking and emergency alert system for Florida residents - powered by National Hurricane Center data">
    
    <!-- Preload critical fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- External libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
        /* CSS Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Color System - NOAA/Emergency Management Standard */
        :root {
            /* Primary Colors */
            --navy-900: #0f172a;
            --navy-800: #1e293b;
            --navy-700: #334155;
            --navy-600: #475569;
            --navy-500: #64748b;
            --navy-400: #94a3b8;
            --navy-300: #cbd5e1;
            --navy-200: #e2e8f0;
            --navy-100: #f1f5f9;
            --navy-50: #f8fafc;
            
            /* Alert System Colors */
            --alert-critical: #dc2626;    /* Red - Imminent threat */
            --alert-high: #ea580c;        /* Orange - High probability */
            --alert-moderate: #d97706;    /* Amber - Moderate risk */
            --alert-low: #16a34a;         /* Green - Low/no threat */
            --alert-info: #0369a1;       /* Blue - Information */
            
            /* System Colors */
            --background: #ffffff;
            --surface: #f8fafc;
            --surface-elevated: #ffffff;
            --border: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            
            /* Spacing System */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            
            /* Typography */
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }
        
        /* Typography System */
        body {
            font-family: var(--font-primary);
            font-size: 0.875rem;
            line-height: 1.5;
            color: var(--text-primary);
            background-color: var(--surface);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .text-display-large {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }
        
        .text-display {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
            letter-spacing: -0.01em;
        }
        
        .text-title-large {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.3;
        }
        
        .text-title {
            font-size: 1.25rem;
            font-weight: 600;
            line-height: 1.3;
        }
        
        .text-subtitle {
            font-size: 1rem;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .text-body-large {
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .text-body {
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .text-caption {
            font-size: 0.75rem;
            line-height: 1.4;
            font-weight: 500;
        }
        
        .text-overline {
            font-size: 0.75rem;
            font-weight: 700;
            line-height: 1.4;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
        
        /* Layout System */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }
        
        .grid {
            display: grid;
            gap: var(--space-6);
        }
        
        .grid-cols-1 { grid-template-columns: 1fr; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        
        /* Card System */
        .card {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--border);
        }
        
        .card-content {
            padding: var(--space-6);
        }
        
        .card-footer {
            padding: var(--space-6);
            border-top: 1px solid var(--border);
            background: var(--surface);
        }
        
        /* Alert System */
        .alert {
            border-radius: 6px;
            padding: var(--space-4) var(--space-6);
            border: 1px solid;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .alert-critical {
            background: #fef2f2;
            border-color: var(--alert-critical);
            color: #7f1d1d;
        }
        
        .alert-high {
            background: #fff7ed;
            border-color: var(--alert-high);
            color: #9a3412;
        }
        
        .alert-moderate {
            background: #fefce8;
            border-color: var(--alert-moderate);
            color: #a16207;
        }
        
        .alert-low {
            background: #f0fdf4;
            border-color: var(--alert-low);
            color: #14532d;
        }
        
        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-critical {
            background: #fef2f2;
            color: var(--alert-critical);
        }
        
        .status-high {
            background: #fff7ed;
            color: var(--alert-high);
        }
        
        .status-moderate {
            background: #fefce8;
            color: var(--alert-moderate);
        }
        
        .status-low {
            background: #f0fdf4;
            color: var(--alert-low);
        }
        
        /* Status dot */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-critical .status-dot {
            background: var(--alert-critical);
        }
        
        .status-high .status-dot {
            background: var(--alert-high);
        }
        
        .status-moderate .status-dot {
            background: var(--alert-moderate);
        }
        
        .status-low .status-dot {
            background: var(--alert-low);
        }
        
        /* Button System */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.875rem;
            border: 1px solid;
            cursor: pointer;
            transition: all 0.15s ease;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--navy-900);
            border-color: var(--navy-900);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--navy-800);
            border-color: var(--navy-800);
        }
        
        .btn-secondary {
            background: white;
            border-color: var(--border);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: var(--surface);
        }
        
        .btn-alert {
            background: var(--alert-critical);
            border-color: var(--alert-critical);
            color: white;
        }
        
        .btn-alert:hover {
            background: #b91c1c;
        }
        
        /* Header System */
        .site-header {
            background: var(--navy-900);
            color: white;
            position: relative;
        }
        
        .site-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--alert-critical) 0%, var(--alert-high) 25%, var(--alert-moderate) 50%, var(--alert-info) 100%);
        }
        
        .header-content {
            padding: var(--space-8) 0;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }
        
        .header-logo {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--navy-900);
            font-size: 1.25rem;
        }
        
        .header-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-4);
        }
        
        .header-badges {
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
        }
        
        .header-badge {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: var(--space-2) var(--space-4);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Emergency Action Bar */
        .emergency-bar {
            background: var(--surface-elevated);
            border: 2px solid var(--alert-critical);
            border-radius: 8px;
            padding: var(--space-6);
            margin: var(--space-8) 0;
            position: relative;
            overflow: hidden;
        }
        
        .emergency-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 38, 38, 0.05), transparent);
            animation: emergency-pulse 3s infinite;
        }
        
        @keyframes emergency-pulse {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            gap: var(--space-4);
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .stat-card {
            text-align: center;
            padding: var(--space-6);
        }
        
        .stat-value {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: var(--space-2);
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .stat-critical .stat-value {
            color: var(--alert-critical);
        }
        
        .stat-high .stat-value {
            color: var(--alert-high);
        }
        
        .stat-moderate .stat-value {
            color: var(--alert-moderate);
        }
        
        .stat-info .stat-value {
            color: var(--alert-info);
        }
        
        /* Map System */
        #hurricane-map {
            height: 500px;
            border-radius: 8px;
            border: 2px solid var(--border);
        }
        
        .map-legend {
            background: var(--surface);
            padding: var(--space-4);
            border-top: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-6);
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);
        }
        
        /* Storm Cards */
        .storm-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .storm-card {
            border-left: 4px solid;
            position: relative;
        }
        
        .storm-card-threat {
            border-left-color: var(--alert-critical);
        }
        
        .storm-card-watch {
            border-left-color: var(--alert-moderate);
        }
        
        .storm-card-normal {
            border-left-color: var(--navy-300);
        }
        
        .storm-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }
        
        .storm-name {
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: var(--space-1);
        }
        
        .storm-classification {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .storm-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-4);
        }
        
        .storm-data-item {
            text-align: center;
            padding: var(--space-3);
            background: var(--surface);
            border-radius: 4px;
        }
        
        .storm-data-value {
            font-weight: 700;
            font-size: 1.125rem;
            margin-bottom: var(--space-1);
        }
        
        .storm-data-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Probability Charts */
        .prob-chart-container {
            position: relative;
            height: 300px;
            margin-top: var(--space-4);
        }
        
        /* Emergency Actions */
        .action-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .action-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            padding: var(--space-4);
            background: var(--surface);
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .action-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.75rem;
            color: white;
            flex-shrink: 0;
            margin-top: var(--space-1);
        }
        
        .action-critical .action-icon {
            background: var(--alert-critical);
        }
        
        .action-high .action-icon {
            background: var(--alert-high);
        }
        
        .action-moderate .action-icon {
            background: var(--alert-moderate);
        }
        
        .action-low .action-icon {
            background: var(--alert-low);
        }
        
        .action-content {
            flex: 1;
        }
        
        .action-title {
            font-weight: 600;
            margin-bottom: var(--space-1);
        }
        
        .action-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--space-3);
            }
            
            .grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .text-display-large {
                font-size: 2rem;
            }
            
            .text-display {
                font-size: 1.875rem;
            }
            
            .header-content {
                padding: var(--space-6) 0;
            }
            
            .header-meta {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #hurricane-map {
                height: 400px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .storm-data {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #hurricane-map {
                height: 350px;
            }
        }
        
        /* Utility Classes */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .text-center { text-align: center; }
        .font-mono { font-family: var(--font-mono); }
        .hidden { display: none; }
        
        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>

<body x-data="hurricaneApp()" x-init="init()">
    <!-- Critical Alert Banner -->
    <div x-show="alertLevel === 'red'" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform -translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         class="alert alert-critical">
        <div class="container">
            <div class="flex items-center justify-center gap-3 text-center">
                <span class="text-lg">⚠️</span>
                <span class="font-semibold" x-text="alertMessage"></span>
                <span class="text-lg">⚠️</span>
            </div>
        </div>
    </div>

    <!-- Site Header -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="header-title">
                    <div class="header-logo">FL</div>
                    <div>
                        <h1 class="text-display-large">Florida Hurricane Alert Dashboard</h1>
                        <p class="text-body-large" style="color: rgba(255, 255, 255, 0.8);">
                            Official Emergency Management System • National Hurricane Center Data
                        </p>
                    </div>
                </div>
                
                <div class="header-meta">
                    <div class="header-badges">
                        <div class="header-badge">
                            <span class="text-overline">Status</span>
                        </div>
                        <div class="header-badge">
                            <span class="text-overline">Atlantic Basin Only</span>
                        </div>
                        <div class="header-badge">
                            <span class="text-overline">Real-time Monitoring</span>
                        </div>
                    </div>
                    
                    <div class="status-indicator" 
                         :class="{
                             'status-critical': alertLevel === 'red',
                             'status-high': alertLevel === 'orange', 
                             'status-moderate': alertLevel === 'yellow',
                             'status-low': alertLevel === 'green'
                         }">
                        <div class="status-dot"></div>
                        <span x-text="alertLevel.toUpperCase() + ' THREAT'"></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Emergency Action Section -->
    <div x-show="alertLevel !== 'green'" class="container">
        <div class="emergency-bar">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div>
                    <h2 class="text-title-large text-red-700 mb-4">Immediate Actions Required</h2>
                    <ul class="action-list">
                        <li class="action-item action-critical" x-show="alertLevel === 'red'">
                            <div class="action-icon">1</div>
                            <div class="action-content">
                                <div class="action-title">Shelter in Place</div>
                                <div class="action-description">Move to interior room away from windows</div>
                            </div>
                        </li>
                        <li class="action-item action-high" x-show="alertLevel === 'orange'">
                            <div class="action-icon">1</div>
                            <div class="action-content">
                                <div class="action-title">Finalize Preparations</div>
                                <div class="action-description">Complete evacuation or shelter plans now</div>
                            </div>
                        </li>
                        <li class="action-item action-moderate" x-show="alertLevel === 'yellow'">
                            <div class="action-icon">1</div>
                            <div class="action-content">
                                <div class="action-title">Monitor Conditions</div>
                                <div class="action-description">Review emergency plans and supplies</div>
                            </div>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-subtitle mb-4">Emergency Resources</h3>
                    <div class="flex flex-col gap-2">
                        <a href="tel:911" class="btn btn-alert">🚨 Call 911 (Emergency)</a>
                        <a href="tel:311" class="btn btn-secondary">📞 Call 311 (Non-Emergency)</a>
                        <a href="https://www.floridadisaster.org" class="btn btn-secondary" target="_blank">🌐 FL Emergency Info</a>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-subtitle mb-4">Current Threat Level</h3>
                    <div class="card">
                        <div class="card-content text-center">
                            <div class="stat-value" 
                                 :class="{
                                     'text-red-600': alertLevel === 'red',
                                     'text-orange-600': alertLevel === 'orange',
                                     'text-yellow-600': alertLevel === 'yellow'
                                 }"
                                 x-text="alertLevel.toUpperCase()"></div>
                            <div class="stat-label">Alert Status</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <main class="container">
        
        <!-- Critical Statistics -->
        <section class="card mb-8">
            <div class="card-header">
                <h2 class="text-title">Current Threat Assessment</h2>
                <p class="text-caption text-secondary mt-1">
                    Last updated: <span x-text="lastUpdate" class="font-mono"></span>
                </p>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card stat-info">
                        <div class="stat-value" x-text="totalSystems"></div>
                        <div class="stat-label">Atlantic Systems</div>
                    </div>
                    <div class="stat-card stat-critical">
                        <div class="stat-value" x-text="floridaThreats"></div>
                        <div class="stat-label">Florida Threats</div>
                    </div>
                    <div class="stat-card stat-high">
                        <div class="stat-value" x-text="activeStorms.length"></div>
                        <div class="stat-label">Active Storms</div>
                    </div>
                    <div class="stat-card stat-moderate">
                        <div class="stat-value" x-text="potentialSystems.length"></div>
                        <div class="stat-label">Developing Areas</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Active Storms Column -->
            <div>
                <div class="card mb-6">
                    <div class="card-header" style="background: var(--alert-critical); color: white;">
                        <h3 class="text-title">Active Atlantic Storms</h3>
                    </div>
                    <div class="card-content">
                        <div x-show="activeStorms.length === 0" class="text-center py-8 text-secondary">
                            <div class="text-4xl mb-4">🌊</div>
                            <p>No active storms detected in Atlantic Basin</p>
                        </div>
                        <div class="storm-list">
                            <template x-for="storm in activeStorms" :key="storm.id">
                                <div class="card storm-card" 
                                     :class="storm.threatens_florida ? 'storm-card-threat' : 'storm-card-normal'">
                                    <div class="card-content">
                                        <div class="storm-header">
                                            <div>
                                                <div class="storm-name" x-text="storm.name"></div>
                                                <div class="storm-classification" x-text="storm.classification"></div>
                                            </div>
                                            <div x-show="storm.threatens_florida" class="status-indicator status-critical">
                                                <div class="status-dot"></div>
                                                <span>FL Threat</span>
                                            </div>
                                        </div>
                                        <div class="storm-data">
                                            <div class="storm-data-item">
                                                <div class="storm-data-value" x-text="storm.intensity"></div>
                                                <div class="storm-data-label">Max Winds (mph)</div>
                                            </div>
                                            <div class="storm-data-item">
                                                <div class="storm-data-value" x-text="storm.pressure"></div>
                                                <div class="storm-data-label">Pressure (mb)</div>
                                            </div>
                                            <div class="storm-data-item">
                                                <div class="storm-data-value" x-text="storm.speed"></div>
                                                <div class="storm-data-label">Speed (mph)</div>
                                            </div>
                                            <div class="storm-data-item">
                                                <div class="storm-data-value" x-text="storm.movement"></div>
                                                <div class="storm-data-label">Direction</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Development Areas -->
                <div class="card">
                    <div class="card-header" style="background: var(--alert-moderate); color: white;">
                        <h3 class="text-title">Development Areas</h3>
                    </div>
                    <div class="card-content">
                        <div x-show="potentialSystems.length === 0" class="text-center py-8 text-secondary">
                            <div class="text-4xl mb-4">☁️</div>
                            <p>No development areas being monitored</p>
                        </div>
                        <div class="storm-list">
                            <template x-for="system in potentialSystems" :key="system.id">
                                <div class="card storm-card"
                                     :class="system.threatens_florida ? 'storm-card-watch' : 'storm-card-normal'">
                                    <div class="card-content">
                                        <div class="storm-header">
                                            <div>
                                                <div class="storm-name" x-text="system.region"></div>
                                                <div class="storm-classification">Tropical Development</div>
                                            </div>
                                            <div x-show="system.threatens_florida" class="status-indicator status-moderate">
                                                <div class="status-dot"></div>
                                                <span>Monitoring</span>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4 mt-4">
                                            <div class="text-center p-4 bg-gray-50 rounded">
                                                <div class="text-2xl font-bold" 
                                                     :class="{
                                                         'text-red-600': system.p48 >= 70,
                                                         'text-orange-600': system.p48 >= 40,
                                                         'text-yellow-600': system.p48 >= 20,
                                                         'text-gray-600': system.p48 < 20
                                                     }" 
                                                     x-text="system.p48 + '%'"></div>
                                                <div class="text-caption text-secondary">48 Hours</div>
                                            </div>
                                            <div class="text-center p-4 bg-gray-50 rounded">
                                                <div class="text-2xl font-bold"
                                                     :class="{
                                                         'text-red-600': system.p7 >= 70,
                                                         'text-orange-600': system.p7 >= 40,
                                                         'text-yellow-600': system.p7 >= 20,
                                                         'text-gray-600': system.p7 < 20
                                                     }" 
                                                     x-text="system.p7 + '%'"></div>
                                                <div class="text-caption text-secondary">7 Days</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map and Chart Column -->
            <div class="lg:col-span-2">
                
                <!-- Hurricane Tracking Map -->
                <div class="card mb-8">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h3 class="text-title">Atlantic Basin Tracking</h3>
                            <button @click="fetchData()" 
                                    class="btn btn-secondary">
                                🔄 Refresh
                            </button>
                        </div>
                    </div>
                    <div class="relative">
                        <div id="hurricane-map"></div>
                        <div class="map-legend">
                            <div class="legend-item">
                                <div class="legend-dot" style="background: var(--alert-critical);"></div>
                                <span>Active Storm</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: var(--alert-moderate);"></div>
                                <span>Development Area</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: var(--alert-info);"></div>
                                <span>Florida Zone</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot" style="background: var(--alert-high);"></div>
                                <span>Threat Zone</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Probability Analysis -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="text-title">Development Probability Analysis</h3>
                        <p class="text-caption text-secondary mt-1">
                            Formation chances for monitored systems
                        </p>
                    </div>
                    <div class="card-content">
                        <div class="prob-chart-container">
                            <canvas id="probChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Preparedness Guide -->
        <section class="card mt-8">
            <div class="card-header">
                <h2 class="text-title">Emergency Preparedness Quick Guide</h2>
            </div>
            <div class="card-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div>
                        <h4 class="text-subtitle text-red-600 mb-3">🔴 Critical Threat</h4>
                        <ul class="action-list">
                            <li class="action-item action-critical">
                                <div class="action-icon">!</div>
                                <div class="action-content">
                                    <div class="action-title">Shelter Now</div>
                                    <div class="action-description">Stay in safe room, away from windows</div>
                                </div>
                            </li>
                            <li class="action-item action-critical">
                                <div class="action-icon">📱</div>
                                <div class="action-content">
                                    <div class="action-title">Emergency Contacts</div>
                                    <div class="action-description">Keep phone charged, 911 ready</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-subtitle text-orange-600 mb-3">🟠 High Risk</h4>
                        <ul class="action-list">
                            <li class="action-item action-high">
                                <div class="action-icon">🏠</div>
                                <div class="action-content">
                                    <div class="action-title">Secure Property</div>
                                    <div class="action-description">Board windows, secure outdoor items</div>
                                </div>
                            </li>
                            <li class="action-item action-high">
                                <div class="action-icon">🚗</div>
                                <div class="action-content">
                                    <div class="action-title">Evacuation Ready</div>
                                    <div class="action-description">Know routes, fuel tank full</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-subtitle text-yellow-600 mb-3">🟡 Moderate Risk</h4>
                        <ul class="action-list">
                            <li class="action-item action-moderate">
                                <div class="action-icon">📦</div>
                                <div class="action-content">
                                    <div class="action-title">Check Supplies</div>
                                    <div class="action-description">Water, food, batteries, medications</div>
                                </div>
                            </li>
                            <li class="action-item action-moderate">
                                <div class="action-icon">📋</div>
                                <div class="action-content">
                                    <div class="action-title">Review Plans</div>
                                    <div class="action-description">Family meeting points, contact info</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-subtitle text-green-600 mb-3">🟢 Low/No Risk</h4>
                        <ul class="action-list">
                            <li class="action-item action-low">
                                <div class="action-icon">📚</div>
                                <div class="action-content">
                                    <div class="action-title">Stay Informed</div>
                                    <div class="action-description">Monitor weather, update plans</div>
                                </div>
                            </li>
                            <li class="action-item action-low">
                                <div class="action-icon">🔧</div>
                                <div class="action-content">
                                    <div class="action-title">Maintenance</div>
                                    <div class="action-description">Test emergency equipment</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Data Sources and Footer -->
        <section class="card mt-8">
            <div class="card-footer">
                <div class="flex flex-wrap justify-between items-center gap-4">
                    <div>
                        <h4 class="text-subtitle mb-2">Official Data Sources</h4>
                        <div class="flex flex-wrap gap-4 text-caption text-secondary">
                            <span>• National Hurricane Center (NHC/NOAA)</span>
                            <span>• Atlantic Basin Monitoring Only</span>
                            <span>• Updates Every 30 Minutes</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-caption text-secondary">System Status</div>
                        <div class="status-indicator status-low">
                            <div class="status-dot"></div>
                            <span>Operational</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
    </main>

    <!-- Footer -->
    <footer style="background: var(--navy-900); color: white; margin-top: 4rem; padding: 2rem 0;">
        <div class="container text-center">
            <div class="text-subtitle mb-2">Florida Hurricane Alert Dashboard</div>
            <div class="text-caption" style="color: rgba(255, 255, 255, 0.7);">
                Official Emergency Management System • Not for navigation • 
                For emergencies call 911 • Non-emergencies call 311
            </div>
            <div class="text-caption mt-4" style="color: rgba(255, 255, 255, 0.5);">
                Monitoring Atlantic Basin & Gulf of Mexico Only • Updates: 2AM, 8AM, 2PM, 8PM EDT
            </div>
        </div>
    </footer>

    <!-- Load JavaScript -->
    <script>
        // Update map initialization to use new ID
        function hurricaneApp() {
            const app = {
                // State
                alertLevel: 'green',
                alertMessage: '',
                totalSystems: 0,
                floridaThreats: 0,
                activeStorms: [],
                potentialSystems: [],
                lastUpdate: 'Never',
                gisAvailable: false,
                alertHistory: [],
                
                // Map
                map: null,
                floridaAOI: null,
                stormMarkers: [],
                showFloridaAOI: true,
                
                // Chart
                probChart: null,
                
                async init() {
                    this.initMap();
                    this.initChart();
                    await this.fetchData();
                    
                    // Auto-refresh every 30 minutes
                    setInterval(() => this.fetchData(), 1800000);
                    
                    // Load alert history from localStorage
                    this.loadAlertHistory();
                },
                
                initMap() {
                    // Initialize Leaflet map with new ID
                    this.map = L.map('hurricane-map').setView([25, -75], 4);
                    
                    // Add professional tile layer
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                        attribution: '© OpenStreetMap contributors © CARTO',
                        subdomains: 'abcd',
                        maxZoom: 20
                    }).addTo(this.map);
                    
                    // Add Florida AOI
                    const floridaBounds = [
                        [24.0, -87.8],
                        [24.0, -79.6],
                        [31.1, -79.6],
                        [31.1, -87.8],
                        [24.0, -87.8]
                    ];
                    
                    this.floridaAOI = L.polygon(floridaBounds, {
                        color: '#0369a1',
                        fillColor: '#0369a1',
                        fillOpacity: 0.1,
                        weight: 2
                    }).addTo(this.map);
                    
                    // Add threat zone (expanded Florida AOI)
                    const threatBounds = [
                        [19.0, -97.8],
                        [19.0, -74.6],
                        [36.1, -74.6],
                        [36.1, -97.8],
                        [19.0, -97.8]
                    ];
                    
                    L.polygon(threatBounds, {
                        color: '#ea580c',
                        fillColor: '#ea580c',
                        fillOpacity: 0.05,
                        weight: 1,
                        dashArray: '5, 10'
                    }).addTo(this.map);
                }
            };

            // Add all the existing methods from the original app.js
            // (The rest of the methods remain the same, just copying them over)
            
            // Copy all other methods from the original hurricaneApp function
            Object.assign(app, {
                initChart() {
                    const ctx = document.getElementById('probChart').getContext('2d');
                    this.probChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: [],
                            datasets: [{
                                label: '48-Hour Probability',
                                data: [],
                                backgroundColor: 'rgba(234, 88, 12, 0.8)',
                                borderColor: 'rgba(234, 88, 12, 1)',
                                borderWidth: 1
                            }, {
                                label: '7-Day Probability',
                                data: [],
                                backgroundColor: 'rgba(220, 38, 38, 0.8)',
                                borderColor: 'rgba(220, 38, 38, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        callback: function(value) {
                                            return value + '%';
                                        },
                                        color: '#64748b'
                                    },
                                    grid: {
                                        color: 'rgba(100, 116, 139, 0.2)'
                                    }
                                },
                                x: {
                                    ticks: {
                                        color: '#64748b'
                                    },
                                    grid: {
                                        color: 'rgba(100, 116, 139, 0.2)'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: {
                                        color: '#64748b'
                                    }
                                }
                            }
                        }
                    });
                },
                
                async fetchData() {
                    try {
                        // First try to fetch from Python backend if available
                        try {
                            const response = await fetch('hurricane_data.json');
                            if (response.ok) {
                                const data = await response.json();
                                this.processBackendData(data);
                                return;
                            }
                        } catch (e) {
                            console.log('Backend data not available, fetching directly...');
                        }
                        
                        // Fallback to direct fetching
                        await this.fetchDirectData();
                        
                    } catch (error) {
                        console.error('Error fetching data:', error);
                        this.alertLevel = 'yellow';
                        this.alertMessage = 'Data fetch error - check console';
                    }
                },
                
                processBackendData(data) {
                    const summary = data.summary;
                    const alerts = data.alerts || [];
                    
                    this.alertLevel = summary.alert_level;
                    this.alertMessage = summary.message;
                    this.totalSystems = summary.total_systems;
                    this.floridaThreats = summary.florida_threats;
                    
                    // Separate active and potential systems
                    this.activeStorms = alerts.filter(a => a.type === 'active');
                    this.potentialSystems = alerts.filter(a => a.type === 'potential');
                    
                    this.lastUpdate = new Date(data.last_check).toLocaleString();
                    
                    // Update map
                    this.updateMap();
                    
                    // Update chart
                    this.updateChart();
                    
                    // Add to alert history if level changed
                    this.updateAlertHistory(summary);
                },
                
                async fetchDirectData() {
                    // Fetch TWO text
                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                    const twoUrl = 'https://forecast.weather.gov/product.php?issuedby=AT&product=TWO&site=NWS&format=txt&glossary=0';
                    
                    const twoResponse = await fetch(proxyUrl + encodeURIComponent(twoUrl));
                    const twoText = await twoResponse.text();
                    
                    // Parse TWO
                    const systems = this.parseTWO(twoText);
                    
                    // Fetch CurrentStorms
                    try {
                        const stormsResponse = await fetch(proxyUrl + 'https://www.nhc.noaa.gov/CurrentStorms.json');
                        const stormsData = await stormsResponse.json();
                        
                        if (stormsData.activeStorms) {
                            stormsData.activeStorms.forEach(storm => {
                                // Get storm identifiers
                                const stormId = (storm.id || '').toLowerCase();
                                const basin = (storm.basin || '').toLowerCase();
                                const binNumber = (storm.binNumber || '').toLowerCase();
                                const stormName = storm.name || 'Unknown';
                                
                                // STRICT ATLANTIC-ONLY FILTERING
                                // Pacific storms have IDs starting with 'ep', 'cp', 'wp'
                                // Pacific storms have basins like 'CP', 'EP', 'WP', 'Pacific'  
                                // Pacific storms have binNumbers starting with 'CP', 'EP', 'WP'
                                
                                const isPacific = (
                                    stormId.startsWith('ep') || 
                                    stormId.startsWith('cp') || 
                                    stormId.startsWith('wp') ||
                                    basin.includes('pacific') ||
                                    basin.includes('ep') ||
                                    basin.includes('cp') ||
                                    basin.includes('wp') ||
                                    binNumber.startsWith('cp') ||
                                    binNumber.startsWith('ep') ||
                                    binNumber.startsWith('wp')
                                );
                                
                                if (isPacific) {
                                    console.log(`SKIPPING Pacific storm: ${stormName} (ID: ${storm.id}, Basin: ${storm.basin}, Bin: ${storm.binNumber})`);
                                    return;
                                }
                                
                                // ONLY ALLOW CONFIRMED ATLANTIC STORMS
                                // Atlantic storms have IDs starting with 'al'
                                // Atlantic storms have binNumbers starting with 'AL' or 'AT'
                                const isAtlantic = (
                                    stormId.startsWith('al') ||
                                    binNumber.startsWith('al') ||
                                    binNumber.startsWith('at')
                                );
                                
                                if (!isAtlantic) {
                                    console.log(`SKIPPING non-Atlantic storm: ${stormName} (ID: ${storm.id}, Basin: ${storm.basin}, Bin: ${storm.binNumber})`);
                                    return;
                                }
                                
                                // Process confirmed Atlantic storm
                                console.log(`ACCEPTED Atlantic storm: ${stormName} (ID: ${storm.id})`);
                                systems.unshift({
                                    id: storm.id,
                                    type: 'active',
                                    name: storm.name,
                                    classification: storm.classification || 'Tropical System',
                                    intensity: storm.intensity || 0,
                                    lat: storm.lat,
                                    lon: storm.lon,
                                    movement: storm.movementDir || 'Stationary',
                                    speed: storm.movementSpeed || 0,
                                    pressure: storm.pressure || 'N/A',
                                    threatens_florida: this.checkFloridaThreat(storm),
                                    p48: 100,
                                    p7: 100,
                                    max_prob: 100
                                });
                            });
                        }
                    } catch (e) {
                        console.error('Error fetching active storms:', e);
                    }
                    
                    // Process systems
                    this.activeStorms = systems.filter(s => s.type === 'active');
                    this.potentialSystems = systems.filter(s => s.type === 'potential');
                    this.totalSystems = systems.length;
                    this.floridaThreats = systems.filter(s => s.threatens_florida).length;
                    
                    // Determine alert level
                    this.determineAlertLevel();
                    
                    this.lastUpdate = new Date().toLocaleString();
                    
                    // Update visualizations
                    this.updateMap();
                    this.updateChart();
                },
                
                parseTWO(text) {
                    const systems = [];
                    const blocks = text.split(/\n\n+/);
                    
                    blocks.forEach((block, i) => {
                        if (block.includes('Formation chance through')) {
                            const m48 = block.match(/through 48 hours[.\s]+(\w+)[.\s]+(\d+)\s*percent/i);
                            const m7 = block.match(/through 7 days[.\s]+(\w+)[.\s]+(\d+)\s*percent/i);
                            
                            const p48 = m48 ? parseInt(m48[2]) : 0;
                            const p7 = m7 ? parseInt(m7[2]) : 0;
                            
                            if (p48 > 0 || p7 > 0) {
                                systems.push({
                                    id: `two_${i}`,
                                    type: 'potential',
                                    region: this.extractRegion(block),
                                    text: block.substring(0, 500),
                                    p48: p48,
                                    p7: p7,
                                    max_prob: Math.max(p48, p7),
                                    threatens_florida: this.checkTextForFloridaThreat(block)
                                });
                            }
                        }
                    });
                    
                    return systems;
                },
                
                extractRegion(text) {
                    const regions = {
                        'gulf of mexico': 'Gulf of Mexico',
                        'caribbean': 'Caribbean',
                        'eastern caribbean': 'E. Caribbean',
                        'western caribbean': 'W. Caribbean',
                        'atlantic': 'Atlantic',
                        'bahamas': 'Bahamas',
                        'lesser antilles': 'Lesser Antilles'
                    };
                    
                    const lower = text.toLowerCase();
                    for (const [key, value] of Object.entries(regions)) {
                        if (lower.includes(key)) return value;
                    }
                    return 'Atlantic Basin';
                },
                
                checkTextForFloridaThreat(text) {
                    const threats = ['florida', 'gulf of mexico', 'bahamas', 'keys', 'southeastern united states'];
                    const lower = text.toLowerCase();
                    return threats.some(t => lower.includes(t));
                },
                
                checkFloridaThreat(storm) {
                    if (!storm.lat || !storm.lon) return false;
                    
                    // Check if in threat zone
                    const inZone = storm.lon >= -97.8 && storm.lon <= -74.6 &&
                                  storm.lat >= 19.0 && storm.lat <= 36.1;
                    
                    // Check movement
                    const threateningMovements = ['w', 'wnw', 'nw', 'n', 'nnw'];
                    const movement = (storm.movementDir || '').toLowerCase();
                    
                    return inZone || threateningMovements.some(m => movement.includes(m));
                },
                
                determineAlertLevel() {
                    const flThreats = this.activeStorms.filter(s => s.threatens_florida);
                    
                    if (flThreats.length > 0) {
                        this.alertLevel = 'red';
                        this.alertMessage = `ACTIVE STORM THREATENING FLORIDA: ${flThreats[0].name || 'System'}`;
                    } else if (this.floridaThreats > 0) {
                        const maxProb = Math.max(...this.potentialSystems.filter(s => s.threatens_florida).map(s => s.max_prob));
                        if (maxProb >= 60) {
                            this.alertLevel = 'orange';
                            this.alertMessage = 'HIGH probability of development near Florida';
                        } else if (maxProb >= 30) {
                            this.alertLevel = 'yellow';
                            this.alertMessage = 'MODERATE probability of development near Florida';
                        } else {
                            this.alertLevel = 'yellow';
                            this.alertMessage = 'LOW probability system being monitored';
                        }
                    } else if (this.totalSystems > 0) {
                        this.alertLevel = 'green';
                        this.alertMessage = 'Systems present but not threatening Florida';
                    } else {
                        this.alertLevel = 'green';
                        this.alertMessage = 'No tropical activity';
                    }
                },
                
                updateMap() {
                    // Clear existing markers
                    this.stormMarkers.forEach(marker => this.map.removeLayer(marker));
                    this.stormMarkers = [];
                    
                    // Add active storm markers
                    this.activeStorms.forEach(storm => {
                        if (storm.lat && storm.lon) {
                            const icon = L.divIcon({
                                html: `<div style="width: 20px; height: 20px; background: #dc2626; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`,
                                className: 'custom-div-icon',
                                iconSize: [20, 20],
                                iconAnchor: [10, 10]
                            });
                            
                            const marker = L.marker([storm.lat, storm.lon], { icon })
                                .bindPopup(`<strong>${storm.name}</strong><br>${storm.classification}<br>Winds: ${storm.intensity} mph`)
                                .addTo(this.map);
                            
                            this.stormMarkers.push(marker);
                        }
                    });
                    
                    // Add potential development areas (mock positions for demo)
                    this.potentialSystems.forEach((system, i) => {
                        // Estimate position based on region
                        const positions = {
                            'Gulf of Mexico': [25, -90],
                            'Caribbean': [15, -75],
                            'E. Caribbean': [13, -60],
                            'W. Caribbean': [15, -85],
                            'Atlantic': [20, -50],
                            'Bahamas': [24, -76],
                            'Lesser Antilles': [15, -61]
                        };
                        
                        const pos = positions[system.region] || [20, -60];
                        
                        const icon = L.divIcon({
                            html: `<div style="width: 18px; height: 18px; background: #d97706; border-radius: 50%; border: 2px solid white; opacity: 0.8; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`,
                            className: 'custom-div-icon',
                            iconSize: [18, 18],
                            iconAnchor: [9, 9]
                        });
                        
                        const marker = L.marker(pos, { icon })
                            .bindPopup(`<strong>${system.region}</strong><br>48hr: ${system.p48}%<br>7-day: ${system.p7}%`)
                            .addTo(this.map);
                        
                        this.stormMarkers.push(marker);
                    });
                },
                
                updateChart() {
                    const labels = [];
                    const data48 = [];
                    const data7 = [];
                    
                    // Add active storms
                    this.activeStorms.forEach(storm => {
                        labels.push(storm.name || 'Active');
                        data48.push(100);
                        data7.push(100);
                    });
                    
                    // Add potential systems
                    this.potentialSystems.forEach(system => {
                        labels.push(system.region);
                        data48.push(system.p48);
                        data7.push(system.p7);
                    });
                    
                    // Update chart
                    this.probChart.data.labels = labels;
                    this.probChart.data.datasets[0].data = data48;
                    this.probChart.data.datasets[1].data = data7;
                    this.probChart.update();
                },
                
                toggleFloridaAOI() {
                    this.showFloridaAOI = !this.showFloridaAOI;
                    if (this.showFloridaAOI) {
                        this.floridaAOI.addTo(this.map);
                    } else {
                        this.map.removeLayer(this.floridaAOI);
                    }
                },
                
                updateAlertHistory(summary) {
                    const entry = {
                        time: new Date().toLocaleTimeString(),
                        message: `${summary.alert_level.toUpperCase()}: ${summary.message}`
                    };
                    
                    this.alertHistory.unshift(entry);
                    this.alertHistory = this.alertHistory.slice(0, 10); // Keep last 10
                    
                    // Save to localStorage
                    localStorage.setItem('alertHistory', JSON.stringify(this.alertHistory));
                },
                
                loadAlertHistory() {
                    const saved = localStorage.getItem('alertHistory');
                    if (saved) {
                        this.alertHistory = JSON.parse(saved);
                    }
                }
            });
            
            return app;
        }
    </script>
</body>
</html>